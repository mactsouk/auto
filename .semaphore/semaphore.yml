version: v1.0
name: Testing Auto Promoting
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu1804

promotions:
- name: stg
  pipeline_path: p1.yml
  auto_trigger_on:
    - result: passed
      branch:
        - "v2-valid."
    - result: failed
      branch:
        - "v2-failing."
- name: prod
  pipeline_path: p2.yml

blocks:
  - name: block1
    task:
      jobs:
        - name: job1
          commands:
            - echo foo
            - echo bar
        - name: job2
          commands:
            - echo baz

  - name: block2
    task:
      jobs:
        - name: job1
          commands:
            - echo foo
            - echo bar
        - name: job2
          commands:
            - echo baz
